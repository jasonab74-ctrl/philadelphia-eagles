<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Philadelphia Eagles — News</title>
  <link rel="icon" href="/static/favicon.ico">
  <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
  <link rel="manifest" href="/static/manifest.webmanifest">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css?v=2025-09-13-1">
  <meta name="color-scheme" content="light dark">
</head>
<body>
  <header class="hero">
    <div class="hero__left">
      <img class="hero__logo" src="/static/logo.png" alt="Eagles logo" width="112" height="112">
      <div>
        <h1 class="hero__title">Philadelphia<br>Eagles — News</h1>
        <p class="hero__subtitle">Live team feed • auto-updates</p>
      </div>
    </div>

    <button id="songBtn" class="song">
      <span class="song__icon" aria-hidden="true">▶</span>
      <span class="song__label">Fly<br>Eagles<br>Fly</span>
    </button>
    <audio id="anthem" preload="auto" src="/static/fly-eagles-fly.mp3"></audio>
  </header>

  <nav class="links">
    <a class="pill" href="https://www.philadelphiaeagles.com/schedule/">Schedule</a>
    <a class="pill" href="https://www.philadelphiaeagles.com/team/roster/">Roster</a>
    <a class="pill" href="https://www.espn.com/nfl/team/depth/_/name/phi">Depth Chart</a>
    <a class="pill" href="https://www.espn.com/nfl/team/injuries/_/name/phi">Injury Report</a>
    <a class="pill" href="https://www.philadelphiaeagles.com/fans/">Fan Zone</a>
    <a class="pill" href="https://store.philadelphiaeagles.com/">Team Shop</a>
    <a class="pill" href="https://www.ticketmaster.com/philadelphia-eagles-tickets/artist/805941">Tickets</a>
    <a class="pill" href="https://www.reddit.com/r/eagles/">Reddit</a>
    <a class="pill" href="https://www.espn.com/nfl/team/_/name/phi/philadelphia-eagles">ESPN Team</a>
    <a class="pill" href="https://sports.yahoo.com/nfl/teams/phi/">Yahoo Team</a>
    <a class="pill" href="https://www.pff.com/nfl/teams/philadelphia-eagles">PFF Team Page</a>
    <a class="pill" href="https://www.pro-football-reference.com/teams/phi/">Pro-Football-Reference</a>
    <a class="pill" href="https://www.nfl.com/news/power-rankings">NFL Power Rankings</a>
    <a class="pill" href="https://www.espn.com/nfl/team/stats/_/name/phi">Stats</a>
    <a class="pill" href="https://www.espn.com/nfl/standings">Standings</a>
  </nav>

  <section class="toolbar">
    <div class="toolbar__group">
      <label class="label" for="sourceSelect">Source:</label>
      <select id="sourceSelect" class="select">
        <option value="__all__">All sources</option>
      </select>
    </div>
    <div class="toolbar__group">
      <span class="label">Updated:</span>
      <time id="updatedAt" class="muted">—</time>
    </div>
  </section>

  <main id="feed" class="feed" aria-live="polite"></main>

  <footer class="foot">
    <small>jasonab74-ctrl.github.io</small>
  </footer>

<script>
(function () {
  const FEED_EL = document.getElementById('feed');
  const SELECT_EL = document.getElementById('sourceSelect');
  const UPDATED_EL = document.getElementById('updatedAt');
  const SONG_BTN = document.getElementById('songBtn');
  const AUDIO = document.getElementById('anthem');

  SONG_BTN.addEventListener('click', () => {
    if (AUDIO.paused) { AUDIO.currentTime = 0; AUDIO.play(); SONG_BTN.classList.add('song--playing'); }
    else { AUDIO.pause(); SONG_BTN.classList.remove('song--playing'); }
  });
  AUDIO.addEventListener('ended', () => SONG_BTN.classList.remove('song--playing'));

  const fmt = (iso) => {
    try {
      const d = new Date(iso);
      return d.toLocaleString(undefined, { month:'short', day:'numeric', year:'numeric', hour:'numeric', minute:'2-digit' });
    } catch { return '—'; }
  };

  const createCard = (item) => {
    const a = document.createElement('a');
    a.className = 'card';
    a.href = item.link;
    a.target = '_blank';
    a.rel = 'noopener noreferrer';

    const h3 = document.createElement('h3');
    h3.className = 'card__title';
    h3.textContent = item.title;

    const meta = document.createElement('p');
    meta.className = 'card__meta';
    meta.textContent = `${item.source} • ${fmt(item.published)}`;

    a.appendChild(h3);
    a.appendChild(meta);
    return a;
  };

  let ALL_ITEMS = [];
  let ALL_SOURCES = [];

  function render() {
    const src = SELECT_EL.value;
    const items = src === '__all__' ? ALL_ITEMS : ALL_ITEMS.filter(i => i.source === src);
    FEED_EL.innerHTML = '';
    for (const it of items) FEED_EL.appendChild(createCard(it));
  }

  async function load() {
    const res = await fetch('items.json?ts=' + Date.now());
    if (!res.ok) throw new Error('items.json fetch failed');
    const data = await res.json();

    UPDATED_EL.textContent = fmt(data.updated_at || new Date().toISOString());

    ALL_ITEMS = Array.isArray(data.items) ? data.items : [];
    ALL_SOURCES = Array.isArray(data.sources) ? data.sources : [];

    // (Re)build source dropdown
    const current = SELECT_EL.value || '__all__';
    SELECT_EL.innerHTML = '<option value="__all__">All sources</option>';
    for (const s of ALL_SOURCES) {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = s;
      SELECT_EL.appendChild(opt);
    }
    if ([...SELECT_EL.options].some(o => o.value === current)) SELECT_EL.value = current;

    render();
  }

  SELECT_EL.addEventListener('change', render);

  // Initial load + auto refresh every 10 minutes
  load().catch(console.error);
  setInterval(load, 10 * 60 * 1000);
})();
</script>
</body>
</html>