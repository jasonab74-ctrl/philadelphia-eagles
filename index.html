<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Philadelphia Eagles â€” News</title>
  <link rel="stylesheet" href="static/style.css" />
  <link rel="icon" href="static/favicon.ico" />
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png" />
  <link rel="manifest" href="static/manifest.webmanifest" />
</head>
<body>
  <header>
    <img src="static/logo.png" alt="Eagles logo" class="logo" />
    <div>
      <h1>Philadelphia Eagles â€” News</h1>
      <small>Live team feed â€¢ auto-updates</small>
    </div>
    <button id="songBtn" class="pill" onclick="toggleSong()">Fly Eagles Fly</button>
  </header>

  <audio id="fightSong" preload="none">
    <source src="static/fly-eagles-fly.mp3" type="audio/mpeg" />
  </audio>

  <nav id="quick-links"></nav>

  <main>
    <div class="controls">
      <label for="sourceSelect">Source:</label>
      <select id="sourceSelect"><option value="all">All sources</option></select>
      <span id="updated"></span>
    </div>
    <div id="feed" class="feed"></div>
  </main>

  <footer><p>Fly Eagles Fly ðŸ¦…</p></footer>

  <script>
    // fight song
    const audioEl = document.getElementById('fightSong');
    const songBtn = document.getElementById('songBtn');
    function toggleSong() {
      if (!audioEl) return;
      if (audioEl.paused) {
        audioEl.currentTime = 0;
        audioEl.play().then(() => {
          songBtn.classList.add('playing'); songBtn.textContent = 'â¸ Pause';
        }).catch(()=>alert('Tap again to allow audio playback.'));
      } else {
        audioEl.pause(); songBtn.classList.remove('playing'); songBtn.textContent = 'Fly Eagles Fly';
      }
    }
    window.addEventListener('pagehide', () => { try { audioEl.pause(); } catch(e){} });

    async function loadFeed() {
      try {
        const res = await fetch('items.json?v=' + Date.now());
        const data = await res.json();
        renderFeed(data);
      } catch (e) {
        console.error('feed error', e);
      }
    }
    function renderFeed(data) {
      const feedEl = document.getElementById('feed');
      const srcSel = document.getElementById('sourceSelect');
      const updatedEl = document.getElementById('updated');
      feedEl.innerHTML = '';
      srcSel.innerHTML = '<option value="all">All sources</option>';
      if (!data || !data.items) return;

      (data.sources || []).forEach(src => {
        const opt = document.createElement('option');
        opt.value = src; opt.textContent = src; srcSel.appendChild(opt);
      });

      if (data.updated_at) {
        updatedEl.textContent = 'Updated: ' + new Date(data.updated_at).toLocaleString();
      }

      function paint(list) {
        feedEl.innerHTML = '';
        list.forEach(item => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <a href="${item.link}" target="_blank" rel="noopener">
              <h3>${item.title}</h3>
              <p class="meta">${item.source} â€¢ ${new Date(item.published).toLocaleString()}</p>
            </a>`;
          feedEl.appendChild(card);
        });
      }
      paint(data.items);
      srcSel.onchange = () => {
        const val = srcSel.value;
        paint(data.items.filter(i => val === 'all' || i.source === val));
      };
    }
    loadFeed();
    setInterval(loadFeed, 5 * 60 * 1000);
  </script>
</body>
</html>