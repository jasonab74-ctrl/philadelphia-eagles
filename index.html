<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Philadelphia Eagles — News</title>

  <!-- IMPORTANT: relative path so it works on GitHub Pages subfolders -->
  <link rel="stylesheet" href="static/style.css" />

  <link rel="icon" href="static/favicon.ico">
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png">
  <meta name="theme-color" content="#0b525b">
  <meta name="description" content="Live Philadelphia Eagles news feed with auto-updates and source filter." />
</head>
<body>
  <header class="hero">
    <div class="brand">
      <img class="logo" src="static/logo.png" alt="Eagles logo"
           onerror="this.style.visibility='hidden'">
      <div>
        <h1>Philadelphia Eagles — <span class="light">News</span></h1>
        <p class="tagline">Live team feed • auto-updates</p>
      </div>
    </div>

    <button id="songBtn" class="pill action" title="Play team song">
      <span class="play">►</span> Fly<br/>Eagles<br/>Fly
    </button>
    <audio id="song" preload="none" src="static/fly-eagles-fly.mp3"></audio>
  </header>

  <nav class="links">
    <a class="pill" href="https://www.philadelphiaeagles.com/schedule/" target="_blank" rel="noopener">Schedule</a>
    <a class="pill" href="https://www.philadelphiaeagles.com/team/" target="_blank" rel="noopener">Roster</a>
    <a class="pill" href="https://www.espn.com/nfl/team/depth/_/name/phi" target="_blank" rel="noopener">Depth Chart</a>
    <a class="pill" href="https://www.philadelphiaeagles.com/team/injury-report/" target="_blank" rel="noopener">Injury Report</a>
    <a class="pill" href="https://www.philadelphiaeagles.com/fans/" target="_blank" rel="noopener">Fan Zone</a>
    <a class="pill" href="https://shop.philadelphiaeagles.com/" target="_blank" rel="noopener">Team Shop</a>
    <a class="pill" href="https://www.ticketmaster.com/philadelphia-eagles-tickets/artist/805949" target="_blank" rel="noopener">Tickets</a>
    <a class="pill" href="https://www.reddit.com/r/eagles/" target="_blank" rel="noopener">Reddit</a>
    <a class="pill" href="https://www.espn.com/nfl/team/_/name/phi/philadelphia-eagles" target="_blank" rel="noopener">ESPN Team</a>
    <a class="pill" href="https://sports.yahoo.com/nfl/teams/phi/" target="_blank" rel="noopener">Yahoo Team</a>
    <a class="pill" href="https://www.pff.com/nfl/teams/philadelphia-eagles" target="_blank" rel="noopener">PFF Team Page</a>
    <a class="pill" href="https://www.pro-football-reference.com/teams/phi/" target="_blank" rel="noopener">Pro-Football-Reference</a>
    <a class="pill" href="https://www.nfl.com/news/power-rankings" target="_blank" rel="noopener">NFL Power Rankings</a>
    <a class="pill" href="https://www.espn.com/nfl/team/stats/_/name/phi" target="_blank" rel="noopener">Stats</a>
    <a class="pill" href="https://www.espn.com/nfl/standings" target="_blank" rel="noopener">Standings</a>
  </nav>

  <section class="toolbar">
    <div class="field">
      <label for="sourceSelect">Source:</label>
      <select id="sourceSelect" class="select">
        <option value="__all__">All sources</option>
      </select>
    </div>
    <div class="updated">
      <span>Updated:</span> <time id="updatedAt">—</time>
    </div>
  </section>

  <main id="feed" class="feed"></main>

  <footer class="footer">
    <small>Powered by GitHub Pages</small>
  </footer>

  <script>
    // --- Audio button ---
    const song = document.getElementById('song');
    document.getElementById('songBtn').addEventListener('click', () => {
      if (song.paused) { song.play(); } else { song.pause(); }
    });

    // --- Helper: US-style date/time ---
    function fmtDate(d) {
      if (!d) return '';
      const t = typeof d === 'number' ? new Date(d) : new Date(String(d));
      if (isNaN(t.getTime())) return '';
      return t.toLocaleString('en-US', {
        month:'short', day:'numeric', year:'numeric',
        hour:'numeric', minute:'2-digit'
      });
    }

    // Pretty names for common Eagles sources
    const PRETTY = {
      'bleedinggreennation.com': 'Bleeding Green Nation',
      'espn.com': 'ESPN',
      'sports.yahoo.com': 'Yahoo Sports — Eagles',
      'philadelphiaeagles.com': 'philadelphiaeagles.com',
      'usatoday.com': 'Eagles Wire (USA Today)',
      'si.com': 'SI — Eagles Today',
      'nbcsports.com': 'ProFootballTalk — Eagles',
      'news.google.com': 'Google News — Eagles',
      'bing.com': 'Bing News — Eagles'
    };

    const feedEl = document.getElementById('feed');
    const selectEl = document.getElementById('sourceSelect');
    const updatedEl = document.getElementById('updatedAt');

    // Robustly pull hostname from a url
    function hostOf(url) {
      try { return new URL(url).hostname.replace(/^www\./,''); }
      catch { return ''; }
    }

    function setUpdated(ts) {
      const txt = fmtDate(ts);
      updatedEl.textContent = txt || '—';
    }

    function render(items, sourceFilter='__all__') {
      // filter and sort
      let list = Array.isArray(items) ? items.slice(0) : [];
      if (sourceFilter !== '__all__') {
        list = list.filter(x => (x.source || hostOf(x.url)) === sourceFilter);
      }
      list.sort((a,b) => new Date(b.published||0) - new Date(a.published||0));
      list = list.slice(0, 50);

      // updated stamp
      const latest = list[0]?.published || items[0]?.published;
      setUpdated(latest);

      // paint
      feedEl.innerHTML = list.map(item => {
        const title = (item.title || 'Untitled').toString();
        const url = item.url || '#';
        const src = item.source || hostOf(url);
        const nice = PRETTY[src] || src;
        const when = fmtDate(item.published);
        return `
          <a class="card" href="${url}" target="_blank" rel="noopener">
            <div class="card-title">${title}</div>
            <div class="card-meta">${nice}${when ? ' • ' + when : ''}</div>
          </a>`;
      }).join('') || `<div class="empty">No articles yet — the collector will populate shortly.</div>`;
    }

    function populateSources(items) {
      // Unique sources present in items.json
      const seen = new Set();
      const entries = [];
      for (const it of items) {
        const key = (it.source || hostOf(it.url));
        if (!key) continue;
        if (!seen.has(key)) {
          seen.add(key);
          entries.push({ key, label: PRETTY[key] || key });
        }
      }
      entries.sort((a,b)=> a.label.localeCompare(b.label));

      // Reset select options (keep "All sources")
      selectEl.innerHTML = `<option value="__all__">All sources</option>` +
        entries.map(s => `<option value="${s.key}">${s.label}</option>`).join('');
    }

    // Fetch items.json with cache-buster so we always see fresh data
    let ALL_ITEMS = [];
    function load() {
      fetch('items.json?ts=' + Date.now())
        .then(r => r.json())
        .then(json => {
          // Defensive: accept both {items:[...]} and [...] shapes
          ALL_ITEMS = Array.isArray(json) ? json : (json.items || []);
          populateSources(ALL_ITEMS);
          render(ALL_ITEMS, selectEl.value);
        })
        .catch(() => {
          feedEl.innerHTML = `<div class="empty">Couldn’t load articles.</div>`;
          setUpdated('');
        });
    }

    // listen for source changes
    selectEl.addEventListener('change', () => render(ALL_ITEMS, selectEl.value));

    // initial load and auto-refresh every 5 minutes
    load();
    setInterval(load, 5 * 60 * 1000);
  </script>
</body>
</html>