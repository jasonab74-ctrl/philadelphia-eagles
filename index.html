<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Philadelphia Eagles — News</title>
  <link rel="stylesheet" href="static/style.css" />
</head>
<body>
  <header>
    <img src="static/logo.png" alt="Philadelphia Eagles" class="logo" />
    <h1>Philadelphia Eagles — News</h1>
    <p>Live team feed • auto-updates</p>
    <button id="fightSong" class="fight-btn">▶ Fly Eagles Fly</button>
  </header>

  <nav id="quick-links">
    <a href="https://www.philadelphiaeagles.com/schedule" target="_blank">Schedule</a>
    <a href="https://www.philadelphiaeagles.com/team/players-roster/" target="_blank">Roster</a>
    <a href="https://www.philadelphiaeagles.com/team/depth-chart/" target="_blank">Depth Chart</a>
    <a href="https://www.philadelphiaeagles.com/team/injury-report/" target="_blank">Injury Report</a>
    <a href="https://www.philadelphiaeagles.com/fans/" target="_blank">Fan Zone</a>
    <a href="https://store.philadelphiaeagles.com" target="_blank">Team Shop</a>
    <a href="https://www.ticketmaster.com/philadelphia-eagles-tickets/artist/806026" target="_blank">Tickets</a>
    <a href="https://www.reddit.com/r/eagles" target="_blank">Reddit</a>
    <a href="https://bleacherreport.com/philadelphia-eagles" target="_blank">Bleacher Report</a>
    <a href="https://www.espn.com/nfl/team/_/name/phi/philadelphia-eagles" target="_blank">ESPN Team</a>
    <a href="https://sports.yahoo.com/nfl/teams/phi/" target="_blank">Yahoo Team</a>
    <a href="https://www.pff.com/nfl/teams/philadelphia-eagles/roster" target="_blank">PFF Team Page</a>
    <a href="https://www.pro-football-reference.com/teams/phi/" target="_blank">Pro-Football-Reference</a>
    <a href="https://www.nfl.com/news/power-rankings" target="_blank">NFL Power Rankings</a>
    <a href="https://www.espn.com/nfl/team/stats/_/name/phi/philadelphia-eagles" target="_blank">Stats</a>
    <a href="https://www.espn.com/nfl/standings" target="_blank">Standings</a>
  </nav>

  <section id="controls">
    <label for="sourceSelect">Source:</label>
    <select id="sourceSelect"></select>
    <span id="lastUpdated">Updated: —</span>
  </section>

  <main id="articles"></main>

  <script>
    const ITEMS_URL = "items.json";
    const sourceSelect = document.getElementById("sourceSelect");
    const articlesContainer = document.getElementById("articles");
    const lastUpdated = document.getElementById("lastUpdated");

    async function loadItems() {
      try {
        const res = await fetch(ITEMS_URL + "?cache=" + Date.now());
        const data = await res.json();

        // Populate sources dropdown
        sourceSelect.innerHTML = "";
        const allOpt = document.createElement("option");
        allOpt.value = "all";
        allOpt.textContent = "All sources";
        sourceSelect.appendChild(allOpt);

        if (data.sources) {
          data.sources.forEach(src => {
            const opt = document.createElement("option");
            opt.value = src;
            opt.textContent = src;
            sourceSelect.appendChild(opt);
          });
        }

        // Update timestamp
        if (data.updated_at) {
          const dt = new Date(data.updated_at);
          lastUpdated.textContent =
            "Updated: " + dt.toLocaleString("en-US", { dateStyle: "medium", timeStyle: "short" });
        }

        // Show articles
        renderArticles(data.items || []);
      } catch (err) {
        console.error("Failed to load items:", err);
      }
    }

    function renderArticles(items) {
      const selected = sourceSelect.value;
      articlesContainer.innerHTML = "";
      items
        .filter(it => selected === "all" || it.source === selected)
        .slice(0, 50)
        .forEach(it => {
          const card = document.createElement("article");
          card.className = "card";
          card.innerHTML = `
            <h2><a href="${it.link}" target="_blank">${it.title}</a></h2>
            <p class="meta">${it.source} • ${new Date(it.published).toLocaleString("en-US", { dateStyle: "medium", timeStyle: "short" })}</p>
          `;
          articlesContainer.appendChild(card);
        });
    }

    sourceSelect.addEventListener("change", () => loadItems());

    // fight song
    const fightBtn = document.getElementById("fightSong");
    const audio = new Audio("static/fight-song.mp3");
    fightBtn.addEventListener("click", () => {
      audio.currentTime = 0;
      audio.play();
    });

    // initial + auto refresh
    loadItems();
    setInterval(loadItems, 60000);
  </script>
</body>
</html>